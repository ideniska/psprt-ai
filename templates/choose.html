{% extends 'base.html' %} {% load static %} {% block content %}
<div class="container mt-5">
  <h1>Step 2 of 2: Choose document type</h1>
  <div class="row mt-5">
    {% if uploaded_files|length > 2 %}
    <div class="col-md-5">
      <div class="row">
        {% for file in uploaded_files%}

        <figure class="figure" style="max-width: 150px">
          <img
            src="{{ file.file.url }}"
            class="img-fluid rounded"
            alt="..."
            width="150"
          />
        </figure>

        {% endfor%}
      </div>
      <div class="row">
        <a
          href="{% url 'upload' %}"
          class="btn btn-warning"
          style="max-width: 300px"
          >Choose different photos</a
        >
      </div>
      <br />
    </div>
    {% else %}
    <div class="col-md-4">
      <div class="row">
        {% for file in uploaded_files%}

        <figure class="figure" style="max-width: 150px">
          <img
            src="{{ file.file.url }}"
            class="img-fluid rounded"
            alt="..."
            width="150"
          />
        </figure>

        {% endfor%}
      </div>
      <div class="row">
        <a
          href="{% url 'upload' %}"
          class="btn btn-warning"
          style="max-width: 300px"
          >Choose different photos</a
        >
      </div>
      <br />
    </div>
    {% endif %}
    <div class="col-md-5">
      <div class="container">
        <form method="post">
          {% csrf_token %} {{ form.as_p }}
          <div id="loading-animation" style="display: none">
            <img src="loading.gif" alt="Loading..." />
          </div>
          <button type="submit" id="submit-button" class="btn btn-primary">
            Prepare photo
          </button>
        </form>
      </div>
    </div>
  </div>
  <br />
  <br />
  <div
    class="progress"
    role="progressbar"
    aria-label="Animated striped example"
    aria-valuenow="75"
    aria-valuemin="0"
    aria-valuemax="100"
    style="max-width: 780px"
  >
    <div
      class="progress-bar progress-bar-striped progress-bar-animated"
      style="width: 50%"
    ></div>
  </div>
</div>

{% comment %}
<script>
  document
    .getElementById("submit-button")
    .addEventListener("click", function () {
      document.getElementById("loading-animation").style.display = "block";
    });

  var source = new EventSource("/status/");
  source.onmessage = function (e) {
    var data = JSON.parse(e.data);
    if (data.status === "completed") {
      document.getElementById("loading-animation").style.display = "none";
      alert(
        "Task completed! You will now be redirected to the preparation page."
      );
      window.location.href = "/prepare/";
    }
  };
</script>
{% endcomment %} {% endblock %}
